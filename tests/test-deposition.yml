---
- name: test that default environment file is correctly deposited
  hosts: localhost
  pre_tasks:
    - name: ensure .irods directory does not exist
      file:
        path: "{{ ansible_env.HOME }}/.irods"
        state: absent

  roles:
    - role: ../../ansible-irods-env

  post_tasks:
    - name: check deposition
      stat:
        path: "{{ ansible_env.HOME }}/.irods/irods_environment.json"
      register: response
      failed_when: >
        not response.stat.exists or
        response.stat.pw_name != ansible_env.USER or
        response.stat.gr_name != ansible_env.USER


- name: test that default server environment file is correctly deposited
  hosts: localhost
  become: true
  pre_tasks:
    - name: ensure .irods directory does not exist
      file:
        path: "/var/lib/irods/.irods"
        state: absent

  roles:
    - role: ../../ansible-irods-env
      irods_env_for_server: true

  post_tasks:
    - name: check deposition
      stat:
        path: "/var/lib/irods/.irods/irods_environment.json"
      register: response
      failed_when: >
        not response.stat.exists or
        response.stat.pw_name != 'irods' or
        response.stat.gr_name != 'irods'
